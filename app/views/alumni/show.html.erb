<h1>Alumnus Profile</h1>
<p><strong>UIN:</strong> <%= @alumnus.uin %></p>
<p><strong>Email:</strong> <%= @alumnus.email %></p>

<h2>Experiences</h2>

<ul id="claimed_experiences">
  <% @alumnus.alumnus_experiences.each do |alumnus_experience| %>
    <li data-id="<%= alumnus_experience.experience.id %>">
      <strong><%= alumnus_experience.experience.title %> (<%= alumnus_experience.experience.experience_type %>)</strong>  
      <br>
      <small>Date Received: <%= alumnus_experience.date_received || "Not Set" %></small>
      <br>
      <p><%= alumnus_experience.custom_description.presence || "No description provided." %></p>
      <br>
      
      <!-- Edit Experience Button -->
      <%= link_to "Edit", edit_alumnus_experience_path(alumnus_experience), class: "btn btn-primary" %>
      
      <!-- JavaScript-powered Remove Button -->
      <a href="#" class="remove_experience" data-id="<%= alumnus_experience.experience.id %>">Remove</a>
      <br> 
    </li>
  <% end %>
</ul>

<h3>Claim Experiences</h3>
<p>Double-click an experience to claim it. Select "Other" to add a new one.</p>

<select id="experience_list" size="5">
  <% Experience.all.each do |experience| %>
    <option value="<%= experience.id %>"><%= experience.title %> - <%= experience.experience_type %></option>
  <% end %>
  <option value="other">Other (Create New Experience)</option>
</select>

<%= form_with url: claim_experiences_alumnus_path(@alumnus), method: :post, id: "experience_form" do %>
  <div id="experience_ids_container">
    <% @alumnus.alumnus_experiences.each do |alumnus_experience| %>
      <input type="hidden" name="experience_ids[]" value="<%= alumnus_experience.experience.id %>">
    <% end %>
  </div>
<% end %>

<div id="experience_modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Add a New Experience</h2>

    <%= form_with model: Experience.new, url: experiences_path, method: :post, id: "new_experience_form", remote: true do |f| %>
      <div>
        <%= f.label :title, "Experience Title" %>
        <%= f.text_field :title, required: true %>
      </div>
    
      <div>
        <%= f.label :experience_type, "Experience Type" %>
        <%= f.text_field :experience_type, required: true %>
      </div>
      
      <input type="hidden" name="experience[alumnus_id]" value="<%= @alumnus.id %>">
    
      <%= f.submit "Save Experience" %>
    <% end %>
  </div>
</div>
<p><%= link_to "Back to Alumni List", alumni_path %></p>

<div id="claim_experience_modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Claim Experience</h2>
    
    <%= form_with url: claim_experiences_alumnus_path(@alumnus), method: :post, id: "claim_experience_form", data: { turbo: "false" } do |f| %>
      <input type="hidden" name="experience_id" id="modal_experience_id">

      <div>
        <%= f.label :date_received, "Date Received" %>
        <%= f.date_field :date_received, required: true %>
      </div>

      <div>
        <%= f.label :custom_description, "Custom Description" %>
        <%= f.text_area :custom_description, placeholder: "Describe your experience with this award.", rows: 5 %>
      </div>

      <%= f.submit "Claim Experience", class: "btn btn-success" %>
    <% end %>
  </div>
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }

  .modal-content {
    background-color: white;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 50%;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }
</style>